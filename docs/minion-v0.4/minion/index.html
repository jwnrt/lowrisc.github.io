<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <title>lowRISC Minion internals &middot; lowRISC</title>
        <link rel="stylesheet" href="https://www.lowrisc.org/css/styles.combined.min.css" />
        <link rel="shortcut icon" href="https://www.lowrisc.org/favicon.ico" />
        <link rel="alternate" href="https://www.lowrisc.org/index.xml" type="application/rss+xml" title="lowRISC" />
        <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Source+Sans+Pro' type='text/css'>
        <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Exo+2' type='text/css'>
        <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-53520714-1', 'auto');
        ga('send', 'pageview');
      </script>
  </head>

  <body data-page="article">
<div class="header">
  <header data-component="menu">

    <section class="outer-container">
      <div class="image">
        <a href="https://www.lowrisc.org"><img src="https://www.lowrisc.org/img/logo.svg"></a>
      </div>

      <div class="menu">
        <ul>
          
          <li><a href="/jobs/"> Jobs </a></li>
          
          <li><a href="/our-work/"> Our work </a></li>
          
          <li><a href="/community/"> Community </a></li>
          
          <li><a href="/blog/"> Blog </a></li>
          
          <li><a href="/about/"> About us </a></li>
          
          <li><a href="/docs/"> Docs </a></li>
          
        </ul>
      </div>
    </section>

  </header>
</div>









    <div class="article">
      <section class="outer-container">
        <div class="row">
            <div class="sixteen columns">
                <article class="li-article">
                
                  <p>
                    <a href="https://www.lowrisc.org/docs/minion-v0.4/">â‡¡ Tutorial for the v0.4 lowRISC release</a>
                  </p>
                
                    <header class="li-article-header">
                        <h1 class="li-article-title">lowRISC Minion internals</h1>
                        <span class="li-article-taxonomies">
                            

                            
                        </span>
                        
                        
                    </header>
                    <section>
                        <p>This lowRISC release introduces Minion cores, allowing I/O tasks to be offloaded from the Rocket. This goal is important because it provides a flexible platform to allow new and unusual devices to be supported.
<a href="http://www.pulp-platform.org/wp-content/uploads/2017/02/datasheet.pdf">From Chapter 3: extract from Pulpino databook</a></p>

<p style="text-align:center;"><img src="../figures/pulpino.png" alt="Drawing" style="width: 800px; padding: 20px 0px;"/></p>

<p style="text-align:center;style=bold;">RISCV core overview from Pulpino databook</p>

<p>The Pulpino as delivered from ETH Zurich is a complete microcontroller, and as such is too large to support our FPGA platform. AXI-compatible busses and peripherals increase the size by 2-3 times. Consequently the decision was taken to only use the core of the previous system, now combined with some key new peripherals:</p>

<ul>
<li>Program RAM (64K, tightly coupled)</li>
<li>Data RAM (64K, tightly coupled)</li>
</ul>

<table>
<thead>
<tr>
<th>Name</th>
<th>Address</th>
<th>Operation</th>
<th>Reset value</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>Program RAM</td>
<td><code>0x00000000</code></td>
<td>Read/Write</td>
<td>Boot program</td>
<td>The initial bootstrap program that can talk to the Rocket</td>
</tr>

<tr>
<td>Data RAM</td>
<td><code>0x00100000</code></td>
<td>Read/Write</td>
<td>Bitstream</td>
<td>Any static data the bootstrap program might need</td>
</tr>

<tr>
<td>UART control</td>
<td><code>0x00200000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td>The UART can only be used if a separate POD interface is purchased</td>
</tr>

<tr>
<td>UART status</td>
<td><code>0x00300000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td>&ldquo;</td>
</tr>

<tr>
<td>SD RX FIFO</td>
<td><code>0x00400000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td>SD-card data will be received via this FIFO</td>
</tr>

<tr>
<td>SD TX FIFO/stat</td>
<td><code>0x00500000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td>SD-card data will be pre-loaded via this FIFO before a transaction</td>
</tr>

<tr>
<td>SD control/stat</td>
<td><code>0x00600000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td>The SD-card IO subsystem is controlled via these registers</td>
</tr>

<tr>
<td>LED ctrl/DIP sw</td>
<td><code>0x00700000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td>Write to LED and/or read from DIP switches</td>
</tr>

<tr>
<td>Shared memory</td>
<td><code>0x00800000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td>An 8K byte window that can be read/written by Minion and Rocket</td>
</tr>

<tr>
<td>Keyboard intf</td>
<td><code>0x00900000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td>The PS/2 keyboard may be polled or read at this address</td>
</tr>

<tr>
<td>VGA text buffer</td>
<td><code>0x00A00000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td>The least significant byte in each 32-bit word is usable</td>
</tr>

<tr>
<td>N/A</td>
<td><code>0x00B00000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td></td>
</tr>

<tr>
<td>N/A</td>
<td><code>0x00C00000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td></td>
</tr>

<tr>
<td>N/A</td>
<td><code>0x00D00000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td></td>
</tr>

<tr>
<td>N/A</td>
<td><code>0x00E00000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td></td>
</tr>

<tr>
<td>Reserved</td>
<td><code>0x00F00000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td></td>
</tr>
</tbody>
</table>

<p>To prevent problems with speculative pre-fetching, no auto incrementing on peripherals is supported. Therefore an I/O address must be written
to before it will yield its first item of data. Although I/O addresses are described as R/W, to save unnecessary hardware, most will
not read back what was written.</p>

<table>
<thead>
<tr>
<th>Name</th>
<th>Address</th>
<th>Operation</th>
<th>Reset value</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>UART transmit</td>
<td><code>0x00200000</code></td>
<td>Write</td>
<td>zero</td>
<td>Add a byte to the UART transmit FIFO (2K entries)</td>
</tr>

<tr>
<td>UART baud rate</td>
<td>`0x00200004</td>
<td>Write</td>
<td>87</td>
<td>The UART baud rate is dependent on the overall system clock (20MHz)</td>
</tr>

<tr>
<td>UART advance FIFO</td>
<td><code>0x00300000</code></td>
<td>Write</td>
<td>zero</td>
<td>The UART receive FIFO advances when this register is written to</td>
</tr>

<tr>
<td>UART status</td>
<td><code>0x00300000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td>&ldquo;</td>
</tr>
</tbody>
</table>

<p>The built-in UART (only accessible via extra PMOD device), uses a simple protocol. Only the receive side is buffered in this version. Majority voting is implemented to reduce the impact of noise in the environment.</p>

<table>
<thead>
<tr>
<th>Name</th>
<th>Address</th>
<th>Operation</th>
<th>Reset value</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>Key FIFO status</td>
<td><code>0x00900000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td>The PS/2 keyboard may be polled or read at this address</td>
</tr>

<tr>
<td>Key FIFO output</td>
<td><code>0x00900000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td>The PS/2 keyboard may be polled or read at this address</td>
</tr>
</tbody>
</table>

<p>The keyboard FIFO has a 512 word buffer on input, and returns the scan code as its LSB, ASCII representation (British keyboards only), as MSB. The conversion to international alphabets may be done under Linux using its usual facilities. No provision to overwrite the code page is provided in this release, though it would be trivial to implement in hardware. The status output gives the number of keys pending and other FIFO information (see minion_soc.sv). Writing an arbitrary value to this address advances the FIFO to the next character.</p>

<table>
<thead>
<tr>
<th>Name</th>
<th>Address</th>
<th>Operation</th>
<th>Reset value</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>VGA text buffer</td>
<td><code>0x00A00000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td>The least significant byte in each 32-bit word is usable</td>
</tr>
</tbody>
</table>

<p>The VGA compatible text display is straightforward in operation. No facility for hardware scrolling is offered, the font is a fixed ASCII-font without non-Roman support. No support for overwriting the font is provided though again, it would be trivial in hardware. The output is a fixed 1024x768 at 75Hz. The buffer is a fixed 16K bytes with a 64K memory map, of which only the LSB is used.</p>

<table>
<thead>
<tr>
<th>Name</th>
<th>Address</th>
<th>Operation</th>
<th>Reset value</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>Shared memory</td>
<td><code>0x00800000</code></td>
<td>Read/Write</td>
<td>zero</td>
<td>An 8K byte window that can be read/written by Minion and Rocket</td>
</tr>
</tbody>
</table>

<p>The shared memory is 8K bytes, operated as 32-bit quantities on both sides of the interface. No provision for collision detection or interrupts is included in this release. The shared memory appears as an extension to the block memory of the Rocket, consequently it starts at 0x40010000 with the standard Chisel memory map. No detection of the presence of the shared memory is made by the Boot ROM, consequently to detect the presence of the Minion</p>

<table>
<thead>
<tr>
<th>Name</th>
<th>Address</th>
<th>Operation</th>
<th>Reset value</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>SD rx current FIFO</td>
<td><code>0x00400000</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD receive FIFO returns its top item when this register is read</td>
</tr>

<tr>
<td>SD rx advance FIFO</td>
<td><code>0x00400000</code></td>
<td>Write</td>
<td>zero</td>
<td>The SD receive FIFO advances when this register is written to</td>
</tr>

<tr>
<td>SD rx status</td>
<td><code>0x00500000</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card status is returned (legacy location)</td>
</tr>

<tr>
<td>SD tx load FIFO</td>
<td><code>0x00500000</code></td>
<td>Write</td>
<td>zero</td>
<td>The SD transmit FIFO receives data when this register is written to</td>
</tr>

<tr>
<td>SD align reg</td>
<td><code>0x00600000</code></td>
<td>Write</td>
<td>zero</td>
<td>Sector align register (not currently used)</td>
</tr>

<tr>
<td>SD clock din</td>
<td><code>0x00600004</code></td>
<td>Write</td>
<td>zero</td>
<td>The data input pin for the SD-clk divider protocol</td>
</tr>

<tr>
<td>SD argument</td>
<td><code>0x00600008</code></td>
<td>Write</td>
<td>zero</td>
<td>The SD-card command argument (such as sector offset for reads)</td>
</tr>

<tr>
<td>SD command</td>
<td><code>0x0060000C</code></td>
<td>Write</td>
<td>zero</td>
<td>The SD-card command number   (such as reset/inquire/read/write)</td>
</tr>

<tr>
<td>SD setting</td>
<td><code>0x00600010</code></td>
<td>Write</td>
<td>zero</td>
<td>The SD-card setting (short/long/with data/read/write)</td>
</tr>

<tr>
<td>SD start</td>
<td><code>0x00600014</code></td>
<td>Write</td>
<td>zero</td>
<td>The SD-card command start register</td>
</tr>

<tr>
<td>SD reset</td>
<td><code>0x00600018</code></td>
<td>Write</td>
<td>zero</td>
<td>The SD-card reset control (clock, data or command)</td>
</tr>

<tr>
<td>SD blkcnt</td>
<td><code>0x0060001C</code></td>
<td>Write</td>
<td>zero</td>
<td>The SD-card number of blocks (currently ignored)</td>
</tr>

<tr>
<td>SD blksize</td>
<td><code>0x00600020</code></td>
<td>Write</td>
<td>zero</td>
<td>The SD-card block size (must be 512 except for inquiry commands)</td>
</tr>

<tr>
<td>SD timeout</td>
<td><code>0x00600024</code></td>
<td>Write</td>
<td>zero</td>
<td>The SD-card timeout for command and data responses (in clocks)</td>
</tr>

<tr>
<td>SD clock crtl</td>
<td><code>0x00600028</code></td>
<td>Write</td>
<td>zero</td>
<td>The SD-card clock divider control register (not supported in s/w)</td>
</tr>

<tr>
<td>SD resp[38:7]</td>
<td><code>0x00600000</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card response register</td>
</tr>

<tr>
<td>SD resp[70:39]</td>
<td><code>0x00600004</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card response register</td>
</tr>

<tr>
<td>SD resp[102:71]</td>
<td><code>0x00600008</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card response register</td>
</tr>

<tr>
<td>SD resp[133:103]</td>
<td><code>0x0060000C</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card response register</td>
</tr>

<tr>
<td>SD cmd wait</td>
<td><code>0x00600010</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card actual waiting time for the last command</td>
</tr>

<tr>
<td>SD status</td>
<td><code>0x00600014</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card FIFO and state-machine status</td>
</tr>

<tr>
<td>SD packet[31:0]</td>
<td><code>0x00600018</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card last command packet sent (including CRC)</td>
</tr>

<tr>
<td>SD packet[47:32]</td>
<td><code>0x0060001C</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card last command packet sent (including CRC)</td>
</tr>

<tr>
<td>SD data wait</td>
<td><code>0x00600020</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card actual waiting time for the last data transfer</td>
</tr>

<tr>
<td>SD transf cnt</td>
<td><code>0x00600024</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card number of 32-bit words transferred in a transaction</td>
</tr>

<tr>
<td>SD rx FIFO stat</td>
<td><code>0x00600028</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card receive FIFO status</td>
</tr>

<tr>
<td>SD tx FIFO stat</td>
<td><code>0x0060002C</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card transmit FIFO status</td>
</tr>

<tr>
<td>SD card detect</td>
<td><code>0x00600030</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card present status</td>
</tr>

<tr>
<td>N/A</td>
<td><code>0x00600034</code></td>
<td>Read</td>
<td><code>0xDEADBEEF</code></td>
<td>Unused</td>
</tr>

<tr>
<td>N/A</td>
<td><code>0x00600038</code></td>
<td>Read</td>
<td><code>0xDEADBEEF</code></td>
<td>Unused</td>
</tr>

<tr>
<td>SD clock dout</td>
<td><code>0x0060003C</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card clock divider response register (not supported in s/w)</td>
</tr>

<tr>
<td>SD align reg</td>
<td><code>0x00600040</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card delayed alignment register readback</td>
</tr>

<tr>
<td>SD clock din</td>
<td><code>0x00600044</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card delayed clock divider data input readback</td>
</tr>

<tr>
<td>SD argument</td>
<td><code>0x00600048</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card delayed argument readback</td>
</tr>

<tr>
<td>SD command</td>
<td><code>0x0060004C</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card delayed command readback</td>
</tr>

<tr>
<td>SD setting</td>
<td><code>0x00600050</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card delayed setting readback</td>
</tr>

<tr>
<td>SD start</td>
<td><code>0x00600054</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card delayed start readback</td>
</tr>

<tr>
<td>SD reset</td>
<td><code>0x00600058</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card delayed reset readback</td>
</tr>

<tr>
<td>SD blkcnt</td>
<td><code>0x0060005C</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card delayed block count readback</td>
</tr>

<tr>
<td>SD blksize</td>
<td><code>0x00600060</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card delayed block size readback</td>
</tr>

<tr>
<td>SD timeout</td>
<td><code>0x00600064</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card delayed timeout readback</td>
</tr>

<tr>
<td>SD clock ctrl</td>
<td><code>0x00600068</code></td>
<td>Read</td>
<td>zero</td>
<td>The SD-card delayed clock control readback</td>
</tr>
</tbody>
</table>

<p style="text-align:center;"><img src="../figures/minion.png" alt="Drawing" style="width: 800px; padding: 20px 0px;"/></p>

<p style="text-align:center;style=bold;">Minion core connectivity</p>

<p>For details of the SD-protocol, it may be helpful (caution: redacted information) to refer to the SD-association website.</p>

<ul>
<li><a href="https://www.sdcard.org/downloads/pls/pdf/index.php?p=Part_1_Physical_Layer_Simplified_Specification_Ver6.00.jpg&amp;f=Part_1_Physical_Layer_Simplified_Specification_Ver6.00.pdf&amp;e=EN_SS1">SD-card association simplified specifications</a></li>
</ul>

                    </section>
                </article>

        </div>
      </section>
    </div>
    
    <div class="row li-pagination article">
      <div class="eight columns">
        <div class="li-pagination-previous">
          &nbsp;
          
        </div>
      </div>
      <div class="eight columns">
        <div class="li-pagination-next">
          &nbsp;
          
        </div>
      </div>
    </div>
    


        <footer>

          <section class="outer-container">

            <div>
              <div class="link-container">
              </div>
            </div>

            <p>
              Unless otherwise noted, content on this site is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution ShareAlike 4.0 International License</a>
            </p>

          </section>

        </footer>
    </body>
</html>

    </body>
</html>

